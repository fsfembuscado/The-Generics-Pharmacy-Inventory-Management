<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'registration/sidebarstyles.css' %}">
    <link rel="stylesheet" href="{% static 'dashboard/dashboardstyles.css' %}">
</head>
<body>
<div class="container">

    {% include 'shared/sidebar.html' %}

    <div class="main-content">
        {% block content %}
        {% if request.user.is_authenticated %}
            <h2>Welcome, <strong>{{ request.user.username }}</strong></h2>
        {% else %}
            <a href="{% url 'login' %}">Login</a>
        {% endif %}

        <!-- action buttons -->
        <!-- <div class="actions" style="margin: 12px 0;">
            <a href="{% url 'medicine-list' %}" class="btn-add">Products</a>
            <a href="{% url 'batch-list' %}" class="btn-add">Batches</a>
            <a href="{% url 'movement-list' %}" class="btn-add">Stock Movements</a>
            <a href="{% url 'dispense' %}" class="btn-add">Dispense</a>
        </div> -->

        <!-- NEW FEATURES SECTION -->
        <!-- {% if is_manager_or_admin %}
        <div style="background: #e9e9e9; padding: 15px; border-radius: 5px; margin: 20px 0;">
            <h4 style="margin-top: 0; color: #1976d2;">üìä Management Tools</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                <a href="{% url 'price-history' %}" class="btn-add" style="background: #d32f2f;">üí∞ Price History</a>
                <a href="{% url 'activity-logs' %}" class="btn-add" style="background: #d32f2f;">üìã Activity Logs</a>
                <a href="{% url 'actual-inventory' %}" class="btn-add" style="background: #d32f2f;">üì¶ Shelf Inventory</a>
                <a href="{% url 'expiration-monitor' %}" class="btn-add" style="background: #d32f2f;">‚ö†Ô∏è Expiration Monitor</a>
                <a href="{% url 'sales-report' %}" class="btn-add" style="background: #d32f2f;">üíµ Sales Report</a>
            </div>
        </div> -->

        <!-- STOCK ANALYSIS SECTION -->
        {% if stock_analysis %}
        <div style="margin: 20px 0;">
            <h3 style="color: #1976d2; margin-bottom: 15px;">üìà Stock Analysis (Last 30 Days)</h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                
                <!-- Fast Selling -->
                <div style="background: #fff; padding: 15px; border-radius: 5px; border-left: 4px solid #4caf50;">
                    <h4 style="margin-top: 0; color: #4caf50;">üî• Fast Selling</h4>
                    {% if stock_analysis.fast_selling %}
                        <table style="width: 100%; font-size: 0.9em;">
                            <thead>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <th style="text-align: left; padding: 5px;">Medicine</th>
                                    <th style="text-align: right; padding: 5px;">Sold</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in stock_analysis.fast_selling %}
                                <tr>
                                    <td style="padding: 5px;">{{ item.medicine__name }}</td>
                                    <td style="text-align: right; padding: 5px; font-weight: bold;">{{ item.total_sold }} pcs</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p style="color: #999; font-style: italic;">No sales data yet</p>
                    {% endif %}
                </div>

                <!-- Slow Selling -->
                <div style="background: #fff; padding: 15px; border-radius: 5px; border-left: 4px solid #ff9800;">
                    <h4 style="margin-top: 0; color: #ff9800;">üêå Slow Selling</h4>
                    {% if stock_analysis.slow_selling %}
                        <table style="width: 100%; font-size: 0.9em;">
                            <thead>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <th style="text-align: left; padding: 5px;">Medicine</th>
                                    <th style="text-align: right; padding: 5px;">Stock</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in stock_analysis.slow_selling %}
                                <tr>
                                    <td style="padding: 5px;">{{ item.name }}</td>
                                    <td style="text-align: right; padding: 5px;">{{ item.current_stock|default:"0" }} pcs</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p style="color: #999; font-style: italic;">All items selling well</p>
                    {% endif %}
                </div>

                <!-- Overstock -->
                <div style="background: #fff; padding: 15px; border-radius: 5px; border-left: 4px solid #2196f3;">
                    <h4 style="margin-top: 0; color: #2196f3;">üì¶ Overstock</h4>
                    {% if stock_analysis.overstock %}
                        <table style="width: 100%; font-size: 0.9em;">
                            <thead>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <th style="text-align: left; padding: 5px;">Medicine</th>
                                    <th style="text-align: right; padding: 5px;">Days</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in stock_analysis.overstock %}
                                <tr>
                                    <td style="padding: 5px;">{{ item.name }}</td>
                                    <td style="text-align: right; padding: 5px; font-weight: bold;">{{ item.days_of_stock }} days</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p style="color: #999; font-style: italic;">No overstock detected</p>
                    {% endif %}
                </div>

                <!-- Understock -->
                <div style="background: #fff; padding: 15px; border-radius: 5px; border-left: 4px solid #f44336;">
                    <h4 style="margin-top: 0; color: #f44336;">‚ö†Ô∏è Understock</h4>
                    {% if stock_analysis.understock %}
                        <table style="width: 100%; font-size: 0.9em;">
                            <thead>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <th style="text-align: left; padding: 5px;">Medicine</th>
                                    <th style="text-align: right; padding: 5px;">Days Left</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in stock_analysis.understock %}
                                <tr>
                                    <td style="padding: 5px;">{{ item.name }}</td>
                                    <td style="text-align: right; padding: 5px; font-weight: bold; color: #f44336;">{{ item.days_of_stock }} days</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p style="color: #999; font-style: italic;">Stock levels healthy</p>
                    {% endif %}
                </div>

            </div>
        </div>
        {% endif %}
        
        {% endif %}
        {% endblock %}
    </div>
</div>

    <script>
    function toggleSidebar() {
        document.getElementById("sidebar").classList.toggle("collapsed");
    }

    function toggleDropdown(id) {
        const dropdown = document.getElementById(id);
        const dropdownLi = dropdown.parentElement;
        
        // Toggle the 'open' class on both the dropdown menu and the parent li
        dropdown.classList.toggle('open');
        dropdownLi.classList.toggle('open');
    }
</script>
</body>
</html>
