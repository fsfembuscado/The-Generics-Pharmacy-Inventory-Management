<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Update Price - {{ medicine.name }}</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'dashboard/dashboardstyles.css' %}">
    <style>
        .container { max-width: 900px; margin: 20px auto; padding: 20px; }
        .medicine-info { background: #e3f2fd; padding: 20px; border-radius: 5px; margin-bottom: 20px; }
        .medicine-info h2 { margin-top: 0; color: #1976d2; }
        .form-section { background: #fff; padding: 25px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 8px; color: #333; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .form-group input:focus, .form-group textarea:focus { outline: none; border-color: #2196F3; }
        .price-display { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .current-price { background: #f5f5f5; padding: 15px; border-radius: 5px; }
        .current-price h4 { margin: 0 0 10px 0; color: #666; }
        .current-price .value { font-size: 1.8em; font-weight: bold; color: #2196F3; }
        .btn-save { padding: 12px 30px; background: #e53935; color: white; border: none; cursor: pointer; font-size: 16px; border-radius: 4px; }
        .btn-save:hover { background: #c62828; }
        .btn-cancel { padding: 12px 30px; background: #999; color: white; text-decoration: none; font-size: 16px; border-radius: 4px; display: inline-block; }
        .price-history-mini { background: #fff3e0; padding: 15px; border-radius: 5px; margin-top: 20px; }
        .price-history-mini h4 { margin-top: 0; }
        .price-history-mini ul { list-style: none; padding: 0; }
        .price-history-mini li { padding: 8px 0; border-bottom: 1px solid #ddd; }
        .warning-box { background: #fff3e0; border-left: 4px solid #f57c00; padding: 15px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Update Medicine Price</h1>
        
        <div class="medicine-info">
            <h2>{{ medicine.name }}</h2>
            <p><strong>Brand:</strong> {{ medicine.brand|default:"Generic" }}</p>
            <p><strong>Category:</strong> {{ medicine.category.name|default:"Uncategorized" }}</p>
            <p><strong>Dosage Form:</strong> {{ medicine.get_dosage_form_display|default:"-" }}</p>
            <p><strong>Strength:</strong> {{ medicine.strength }}</p>
        </div>

        <div class="warning-box">
            <strong>⚠️ Important:</strong> This form is specifically for updating prices only. 
            To maintain data integrity, other medicine details cannot be modified here. 
            Use the regular medicine edit form for other changes.
        </div>

        <form method="POST">
            {% csrf_token %}
            
            <div class="form-section">
                <h3>Current Prices</h3>
                <div class="price-display">
                    <div class="current-price">
                        <h4>Current Base Price</h4>
                        <div class="value">₱{{ medicine.base_price|floatformat:2 }}</div>
                    </div>
                    <div class="current-price">
                        <h4>Current Selling Price</h4>
                        <div class="value">₱{{ medicine.selling_price|floatformat:2 }}</div>
                    </div>
                </div>

                <h3 style="margin-top: 30px;">New Prices</h3>
                
                <div class="form-group">
                    <label for="id_base_price">Base Price (₱):</label>
                    {{ form.base_price }}
                    {% if form.base_price.errors %}
                        <div style="color: red; margin-top: 5px;">{{ form.base_price.errors }}</div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="id_selling_price">Selling Price (₱):</label>
                    {{ form.selling_price }}
                    {% if form.selling_price.errors %}
                        <div style="color: red; margin-top: 5px;">{{ form.selling_price.errors }}</div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="reason">Reason for Price Change (Optional):</label>
                    <textarea name="reason" id="reason" rows="3" placeholder="e.g., Supplier price increase, Market adjustment, Promotional pricing..."></textarea>
                </div>

                <div style="margin-top: 20px;">
                    <button type="submit" class="btn-save">Save Price Changes</button>
                    <a href="{% url 'price-history' %}" class="btn-cancel">Cancel</a>
                </div>
            </div>
        </form>

        {% if price_history %}
        <div class="price-history-mini">
            <h4>Recent Price Changes (Last 5)</h4>
            <ul>
                {% for change in price_history %}
                <li>
                    <strong>{{ change.change_date|date:"M d, Y g:i A" }}</strong> - 
                    ₱{{ change.old_selling_price|floatformat:2 }} → ₱{{ change.new_selling_price|floatformat:2 }}
                    <br><small style="color: #666;">by {{ change.changed_by.username }}</small>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <a href="{% url 'price-history' %}" class="btn-add" style="margin-top: 20px; display: inline-block;">← Back to Price History</a>
    </div>
</body>
</html>
