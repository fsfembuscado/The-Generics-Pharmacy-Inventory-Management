<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Purchase Order</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'registration/sidebarstyles.css' %}">
    <link rel="stylesheet" href="{% static 'registration/userliststyles.css' %}">
    <style>
        .items-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .items-table th, .items-table td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        .items-table th { background: #f44336; color: white; font-weight: 600; }
        .btn-remove { background: #f44336; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        .form-actions { margin-top: 20px; display: flex; gap: 10px; }
    </style>
</head>
<body>
<div class="container">
    {% include 'shared/sidebar.html' %}

    <div class="main-content">
        <h2>Create Purchase Order</h2>
        <p style="color: #666; margin-bottom: 20px;">Add all medicines you want to order in this single purchase order. Click "+ Add Another Medicine" to add more items.</p>

        <form method="post" id="po-form">
            {% csrf_token %}
            
            <table class="items-table" id="items-table">
                <thead>
                    <tr>
                        <th style="width: 40%;">Medicine</th>
                        <th style="width: 15%;">Quantity (Boxes)</th>
                        <th style="width: 20%;">Manufactured Date</th>
                        <th style="width: 20%;">Expiration Date</th>
                        <th style="width: 5%;"></th>
                    </tr>
                </thead>
                <tbody id="items-body">
                    <tr class="item-row">
                        <td>
                            <select name="medicine[]" required style="width: 100%; padding: 8px;">
                                <option value="">-- Select Medicine --</option>
                                {% for medicine in medicines %}
                                <option value="{{ medicine.id }}">{{ medicine.name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td><input type="number" name="quantity[]" required min="1" value="1" style="width: 100%; padding: 8px;"></td>
                        <td><input type="date" name="manufactured_date[]" required style="width: 100%; padding: 8px;"></td>
                        <td><input type="date" name="expiration_date[]" required style="width: 100%; padding: 8px;"></td>
                        <td><button type="button" class="btn-remove" onclick="removeRow(this)" style="display: none;">Ã—</button></td>
                    </tr>
                </tbody>
            </table>
            
            <button type="button" onclick="addRow()" style="padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">+ Add Another Medicine</button>
            
            <div style="margin-top: 20px;">
                <label style="display: block; font-weight: 500; margin-bottom: 5px;">Notes (Optional)</label>
                <textarea name="notes" rows="3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
            </div>
            
            <div class="form-actions">
                <button type="submit" style="padding: 10px 30px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">Create Order</button>
                <a href="{% url 'purchase-order-list' %}" style="padding: 10px 30px; background: #666; color: white; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block;">Cancel</a>
            </div>
        </form>
    </div>
</div>

<script>
function addRow() {
    const tbody = document.getElementById('items-body');
    const newRow = tbody.rows[0].cloneNode(true);
    
    // Clear values
    newRow.querySelector('input[type="number"]').value = '1';
    newRow.querySelector('select').selectedIndex = 0;
    newRow.querySelectorAll('input[type="date"]').forEach(input => input.value = '');
    
    // Show remove button
    newRow.querySelector('.btn-remove').style.display = 'inline-block';
    
    tbody.appendChild(newRow);
    updateRemoveButtons();
}

function removeRow(btn) {
    btn.closest('tr').remove();
    updateRemoveButtons();
}

function updateRemoveButtons() {
    const rows = document.querySelectorAll('.item-row');
    rows.forEach((row, index) => {
        const removeBtn = row.querySelector('.btn-remove');
        removeBtn.style.display = rows.length > 1 ? 'inline-block' : 'none';
    });
}
</script>
</body>
</html>
